<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>FrequenCE SUD - Sud CRM59</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bento-gap: 16px; /* Espacement global */
      --bento-border-radius: 24px; /* Arrondi global */
      --color-primary: #ff66c4; /* Rose SUD */
      --color-secondary: #fffe00; /* Jaune SUD */
      --color-text: #202020;
      --color-background-card: #ffffff; /* Le blanc du cadre et des cartes */
      --color-background-page: #f0f2f5; /* Fond de page gris clair */
      --color-text-on-secondary: #202020; /* Texte sur fond jaune */
    }

    body {
      font-family: 'Inter', Arial, sans-serif;
      background-color: var(--color-background-page);
      margin: 0;
      padding: 0;
      min-height: 100vh;
      color: var(--color-text);
      display: flex; /* Utilisation de flexbox pour centrer le cadre blanc */
      justify-content: center;
      align-items: flex-start; /* Aligne le contenu en haut si pas assez de hauteur */
      padding: var(--bento-gap) 0; /* Padding vertical pour le corps */
    }

    /* --- NOUVEAU CONTENEUR POUR LE CADRE BLANC --- */
    .main-white-frame {
        background-color: var(--color-background-card); /* Fond blanc */
        max-width: 1040px; /* Légèrement plus large que le contenu intérieur (1000px + padding) */
        width: calc(100% - var(--bento-gap) * 2); /* Prend 100% de la largeur moins le padding du body */
        border-radius: var(--bento-border-radius);
        box-shadow: 0 8px 30px rgba(0,0,0,0.1); /* Ombre pour l'effet flottant */
        overflow: hidden; /* Important pour les coins arrondis et le contenu qui déborde */
        margin: 0; /* Marges gérées par le body */
        display: flex;
        flex-direction: column; /* Organise les sections verticalement */
        align-items: stretch; /* Les sections s'étirent sur toute la largeur */
    }

    .header-banner {
      background-color: var(--color-primary); /* Fond rose SUD */
      padding: 30px var(--bento-gap);
      text-align: center;
      max-width: 100%; /* S'adapte à son parent */
      margin: 0; /* Pas de marge car il est dans le cadre blanc */
      border-radius: 0; /* Pas d'arrondis sur le header lui-même car le cadre blanc les fournit */
      box-shadow: none; /* Pas d'ombre individuelle */
      color: var(--color-text-on-secondary);
      box-sizing: border-box;
    }
    .header-banner img.logo-syndicat {
      width: 160px;
      border-radius: 50%;
      border: 3px solid var(--color-primary);
      background: #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 10px;
      object-fit: cover;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    .header-banner h1 {
      margin: 0 0 5px 0;
      font-size: 1.8em;
      font-weight: 700;
      color: var(--color-secondary);
    }
    .header-banner p { margin: 0; font-size: 1em; color: var(--color-text-on-secondary);}

.bento-board {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-auto-rows: minmax(150px, auto); /* Permet aux lignes de s'agrandir */
      gap: var(--bento-gap);
      max-width: 100%; /* S'adapte à son parent */
      margin: var(--bento-gap) var(--bento-gap) 40px var(--bento-gap); /* Top, Left/Right, Bottom margins */
      padding: 0; /* Pas de padding ici */
      border-radius: 0; /* Pas d'arrondis ici */
      overflow: visible; /* <--- MODIFIÉ: Autorise le contenu des cartes à ne pas être tronqué */
    }

    .card {
      background-color: var(--color-background-card);
      border-radius: var(--bento-border-radius);
      box-shadow: 0 4px 12px rgba(0,0,0,0.05), 0 1px 3px rgba(0,0,0,0.03);
      padding: 20px;
      position: relative;
      transition: transform .2s ease-out, box-shadow .2s ease-out;
      opacity: 0;
      animation: fadeInPop .5s ease-out forwards;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      color: var(--color-text);
    }

    /* --- Tailles des cartes (doivent correspondre au dashboard) --- */
    .card-col-span-2 { grid-column: span 2; }
    .card-col-span-3 { grid-column: span 3; }
    .card-col-span-4 { grid-column: span 4; }
    .card-row-span-2 { grid-row: span 2; min-height: calc( (150px * 2) + var(--bento-gap) ); }
    .card.card-col-span-2.card-row-span-2 { min-height: calc( (150px * 2) + var(--bento-gap) ); }


    /* Style interne des cartes */
    .card-icon-large {
        font-size: 2.8em;
        margin-bottom: 12px;
        color: var(--color-primary);
        line-height: 1;
    }
     .emoji-icon {
        font-size: 1.8em;
        margin-right: 10px;
        vertical-align: -0.15em;
    }
    .card-title {
      font-size: 1.1em;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--color-text);
      line-height: 1.3;
    }
    .card-content-wrapper {
        flex-grow: 1;
        overflow-y: auto;
        font-size: 0.9em;
        line-height: 1.5;
        color: #444;
    }
     .card-content-wrapper .extra-content {
        display: none;
        margin-top:10px;
    }
    .card.expanded .card-content-wrapper .extra-content {
        display: block;
    }
    /* Cas d'une carte avec image de fond */
    .card-with-image {
        background-size: cover;
        background-position: center;
        color: white;
        position: relative;
    }
    .card-with-image::before {
        content: '';
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        background-color: rgba(0,0,0,0.3);
        border-radius: var(--bento-border-radius);
        z-index: 0;
    }
    .card-with-image > * { position: relative; z-index: 1; }
    .card-with-image .card-title, .card-with-image .card-content-wrapper, .card-with-image .card-icon-large { color: white; }


    .card-actions {
      margin-top: auto;
      padding-top: 15px;
      flex-shrink: 0;
    }
    .btn {
      display: inline-block;
      background-color: var(--color-primary);
      color: white !important;
      padding: 8px 16px;
      border-radius: 50px;
      font-weight: 500;
      text-decoration: none;
      font-size: 0.85em;
      border: none;
      cursor: pointer;
      transition: background-color .2s, transform .2s;
    }
    .btn:hover { background-color: #d6136a; transform: translateY(-1px); }
    .btn-secondary {
        background-color: transparent;
        color: var(--color-primary) !important;
        border: 1px solid var(--color-primary);
    }
    .btn-secondary:hover { background-color: #fde7f0; }

    /* Classe pour texte clair sur fond sombre */
    .card.text-light {
        color: #fff;
    }
    .card.text-light .card-title {
        color: #fff;
    }
    .card.text-light .card-content-wrapper {
        color: #eee;
    }
    .card.text-light .btn-secondary {
        color: #fff !important;
        border-color: #fff;
    }
    .card.text-light .btn-secondary:hover {
        background-color: rgba(255,255,255,0.1);
    }
    .card.text-light .emoji-icon {
        background: rgba(255,255,255,0.1);
        border-color: rgba(255,255,255,0.2);
    }
    .card.text-light .card-icon-large {
        color: #fff;
    }


    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.07), 0 2px 6px rgba(0,0,0,0.04);
    }
    .card.expanded { }

    @keyframes fadeInPop {
      from { opacity:0; transform: scale(0.95) translateY(10px); }
      to { opacity:1; transform: scale(1) translateY(0); }
    }

    /* --- Styles du menu d'archives --- */
    .archive-section {
        max-width: 100%; /* S'adapte à son parent */
margin: 0 var(--bento-gap) 40px var(--bento-gap); 
        padding: 0; /* Pas de padding ici */
        text-align: center;
        box-sizing: border-box;
    }
    .archive-section h3 {
        color: var(--color-text);
        font-size: 1.2em;
        font-weight: 700;
        margin-bottom: 20px;
        padding: 0 var(--bento-gap); /* Padding pour le texte */
    }
    .archive-menu {
        display: flex;
        flex-wrap: nowrap; /* Empêche les chips de passer à la ligne */
        overflow-x: auto; /* Permet le défilement horizontal */
        -webkit-overflow-scrolling: touch; /* Pour un défilement fluide sur iOS */
        gap: 12px; /* Espace entre les chips */
        padding: 12px var(--bento-gap); /* Padding pour le défilement */
        justify-content: center; /* Centre les chips si l'espace le permet */
        scrollbar-width: thin; /* For Firefox */
        scrollbar-color: var(--color-primary) var(--color-background-page); /* For Firefox */
    }
    /* Style de la scrollbar pour Webkit (Chrome, Safari) */
    .archive-menu::-webkit-scrollbar {
        height: 6px;
    }
    .archive-menu::-webkit-scrollbar-track {
        background: var(--color-background-page);
        border-radius: 10px;
    }
    .archive-menu::-webkit-scrollbar-thumb {
        background-color: var(--color-primary);
        border-radius: 10px;
        border: 1px solid var(--color-background-page);
    }

    .archive-chip {
        display: inline-flex; /* Pour centrer le texte verticalement */
        align-items: center;
        padding: 8px 16px;
        background-color: #fff;
        border-radius: 20px; /* Coins très arrondis */
        text-decoration: none;
        color: var(--color-text);
        font-size: 0.9em;
        font-weight: 500;
        white-space: nowrap; /* Empêche le texte de passer à la ligne */
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        transition: background-color 0.2s, box-shadow 0.2s, transform 0.1s;
        border: 1px solid #e0e0e0; /* Légère bordure pour le relief */
        flex-shrink: 0; /* Empêche les chips de rétrécir en défilant */
    }
    .archive-chip:hover {
        background-color: var(--color-primary);
        color: #fff;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        transform: translateY(-1px);
        border-color: var(--color-primary);
    }
    .archive-chip.active {
        background-color: var(--color-primary);
        color: #fff;
        box-shadow: 0 0 0 2px var(--color-primary), 0 2px 8px rgba(0,0,0,0.1);
        font-weight: 600;
        cursor: default;
    }

    /* --- Styles pour la ligne de séparation --- */
    .section-separator {
        display: block; /* Assure que c'est un bloc */
        height: 1px; /* Assure une hauteur minimale */
        width: 100%; /* S'étend sur la largeur disponible du parent */
        max-width: calc(100% - var(--bento-gap) * 2); /* Limité par les marges du conteneur parent */
        background-color: var(--color-primary); /* Utilise la couleur primaire rose */
        /* background-color: red !important;  <-- Vous pouvez temporairement le mettre en rouge vif pour le test */
        border: 0; /* Élimine toutes les bordures par défaut (plus fort que 'none') */
        padding: 0; /* Élimine tout padding par défaut */
        margin: 40px auto; /* Espacement vertical, centré */
        box-sizing: border-box;
    }

    /* --- Styles pour la section ÉQUIPE --- */
    .team-contact-section {
        max-width: 100%; /* S'adapte à son parent */
        margin: var(--bento-gap); /* Marge intérieure au cadre blanc */
        padding: 0; /* Pas de padding ici */
        text-align: center;
        box-sizing: border-box;
        color: var(--color-text);
    }
    .team-contact-section p {
        font-size: 0.9em;
        line-height: 1.5;
        margin-bottom: 10px;
        padding: 0 var(--bento-gap); /* Padding pour le texte */
    }
    .team-contact-section p:last-of-type {
        margin-bottom: 20px;
    }
    .team-contact-section a {
        color: var(--color-primary);
        text-decoration: none;
        font-weight: 500;
    }
    .team-contact-section a:hover {
        text-decoration: underline;
    }

    .team-photos {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 20px;
        margin-bottom: 20px;
        padding: 0 var(--bento-gap); /* Padding pour les photos */
    }
    .team-photo-wrapper {
        text-align: center;
        flex-shrink: 0;
    }
    .team-photo-wrapper img {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid var(--color-secondary);
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        display: block;
        margin: 0 auto;
        transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
    }
    .team-photo-wrapper img:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    /* --- STYLES POUR LA BANNIÈRE DE L'APP (IMAGE UNIQUE) --- */
    .app-banner-section {
          /* <--- MODIFIÉ: Laisser Flexbox gérer le centrage, pas de width fixe */
          margin: calc(var(--bento-gap) * 0.8);
          padding: 0; /* Important pour que l'image remplisse */
      }
      /* Ajustement du lien a à l'intérieur pour le centrage */
      .app-banner-section a {
          width: auto; /* Laisse l'élément a déterminer sa largeur par le contenu */
          max-width: 100%; /* S'assure que le lien ne déborde pas */
          margin: 0 auto; /* Centre le lien lui-même */
      }

    .app-banner-section img.app-banner-image {
        width: 100%;
        height: auto;
        display: block;
        border-radius: var(--bento-border-radius);
        /* AJOUT: S'assurer que l'image ne déborde pas à cause de son propre contenu ou bordures */
        max-width: 100%;
        box-sizing: border-box; /* S'assurer que padding/border ne s'ajoutent pas à la largeur */
    }

    /* --- Styles du footer (Raffiné) --- */
    .footer-contact {
        background-color: var(--color-primary);
        color: #fff;
        padding: 30px var(--bento-gap);
        text-align: center;
        margin: 0; /* Pas de marge pour coller au bas du cadre blanc */
        max-width: 100%; /* S'adapte à son parent */
        border-radius: 0; /* Pas d'arrondis sur le footer lui-même */
        box-shadow: none; /* Pas d'ombre individuelle */
        box-sizing: border-box;
    }
    .footer-contact .qr-code {
        margin-bottom: 20px;
        border-radius: 12px;
        border: 4px solid #fff;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        max-width: calc(100% - 40px); /* <--- AJOUTÉ: Empêche le débordement de l'image si elle a une bordure */
        height: 200px; /* <--- AJOUTÉ: Pour maintenir le ratio si max-width est appliquée */
    }
    .footer-contact p {
        margin: 0 0 8px 0;
        font-size: 0.9em;
        line-height: 1.6;
    }
    .footer-contact a {
        color: #fff;
        text-decoration: underline;
        font-weight: 500;
    }
    .footer-contact a:hover {
        text-decoration: none;
        opacity: 0.8;
    }

    /* --- NOUVEAUX STYLES POUR LES CARTES ET LA MODALE --- */
    .card .open-modal-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: rgba(255, 255, 255, 0.8);
        border: 1px solid rgba(0,0,0,0.1);
        border-radius: 50%;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5em;
        line-height: 1;
        cursor: pointer;
        transition: background-color 0.2s, transform 0.2s, opacity 0.2s;
        opacity: 0.7;
        z-index: 2;
        color: var(--color-text);
        font-weight: bold;
    }
    .card .open-modal-btn:hover {
        background-color: #fff;
        transform: scale(1.1);
        opacity: 1;
    }

    .card-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .card-modal.is-open {
        opacity: 1;
        visibility: visible;
    }

    .card-modal-content {
        background-color: #fff;
        border-radius: var(--bento-border-radius);
        padding: 30px;
        max-width: 800px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        transform: scale(0.9);
        transition: transform 0.3s ease;
        display: flex;
        flex-direction: column;
        color: var(--color-text);
    }
    .card-modal.is-open .card-modal-content {
        transform: scale(1);
    }

    .card-modal-close-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        font-size: 2.5em;
        cursor: pointer;
        color: #777;
        line-height: 1;
        transition: color 0.2s;
    }
    .card-modal-close-btn:hover {
        color: #333;
    }

    .modal-header {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        border-bottom: 1px solid #eee;
        padding-bottom: 15px;
    }
    .modal-emoji {
        font-size: 2.5em;
        margin-right: 15px;
        line-height: 1;
        flex-shrink: 0;
    }
    .modal-title {
        margin: 0;
        font-size: 1.6em;
        font-weight: 700;
        color: var(--color-primary);
        line-height: 1.3;
    }
    .modal-image-container {
        margin-bottom: 20px;
        text-align: center;
    }
    .modal-image {
        max-width: 100%;
        height: auto;
        border-radius: 12px;
        display: block;
        margin: 0 auto;
    }
    .modal-content-text {
        font-size: 1em;
        line-height: 1.6;
        color: #444;
        flex-grow: 1;
        margin-bottom: 20px;
    }
    .modal-content-text .extra-content {
        margin-top: 15px;
        border-top: 1px dashed #ddd;
        padding-top: 15px;
    }

    .modal-actions {
        margin-top: auto;
        text-align: center;
        padding-top: 15px;
        border-top: 1px solid #eee;
    }
    .modal-btn-link {
        background-color: var(--color-primary);
        color: white !important;
        padding: 10px 20px;
        border-radius: 50px;
        font-weight: 500;
        text-decoration: none;
        font-size: 0.95em;
        transition: background-color .2s, transform .2s;
    }
    .modal-btn-link:hover {
        background-color: #d6136a;
        transform: translateY(-1px);
    }

    .card-modal-content.text-light .modal-title,
    .card-modal-content.text-light .modal-content-text,
    .card-modal-content.text-light .modal-emoji {
        color: #fff;
    }
    .card-modal-content.text-light .card-modal-close-btn {
        color: #ccc;
    }
    .card-modal-content.text-light .card-modal-close-btn:hover {
        color: #fff;
    }


    /* --- Responsive --- */
    @media (max-width: 900px) {
        .bento-board {
            grid-template-columns: repeat(3, 1fr);
        }
        .card-col-span-4 { grid-column: span 3; }
        .main-white-frame {
            width: calc(100% - var(--bento-gap)); /* Réduit un peu plus le cadre sur les côtés */
            border-radius: 20px; /* Légèrement moins arrondi */
        }
        /* Les sections internes s'adapteront car elles sont à max-width: 100% */
        .section-separator {
            max-width: calc(100% - var(--bento-gap) * 2); /* Garde la séparation à l'intérieur du cadre */
        }
    }

    @media (max-width: 680px) {
      .bento-board {
        grid-template-columns: repeat(2, 1fr);
        grid-auto-rows: minmax(140px, auto);
        gap: calc(var(--bento-gap) * 0.8);
        margin: calc(var(--bento-gap) * 0.8); /* Marge intérieure réduite */
      }
      .card { padding: 15px; }
      .card-col-span-3, .card-col-span-4 { grid-column: span 2; }
      .card.card-row-span-2 { min-height: calc( (140px * 2) + var(--bento-gap) * 0.8 );}
      .card.card-col-span-2.card-row-span-2 { min-height: calc( (140px * 2) + var(--bento-gap) * 0.8 );}

      .header-banner {
          padding: 20px calc(var(--bento-gap) * 0.8);
      }
      .header-banner h1 {font-size:1.6em;}
      .header-banner p {font-size:0.9em;}
      .card-title { font-size: 1em; }
      .card-content-wrapper { font-size: 0.85em; }
      .archive-section {
          margin: calc(var(--bento-gap) * 0.8);
      }
      .archive-menu {
          padding: 8px calc(var(--bento-gap) * 0.8);
      }
      .section-separator {
          margin: 30px auto;
          max-width: calc(100% - var(--bento-gap) * 1.6); /* Ajuste pour le padding du body */
      }
      .team-contact-section {
          margin: calc(var(--bento-gap) * 0.8);
      }
      .team-contact-section p {
          padding: 0 calc(var(--bento-gap) * 0.8);
      }
      .team-photos {
          padding: 0 calc(var(--bento-gap) * 0.8);
      }
      .team-photo-wrapper img {
          width: 70px;
          height: 70px;
      }
      .app-banner-section {
          margin: calc(var(--bento-gap) * 0.8);
          width:250px;
          text-align:center;
      }
      .footer-contact {
          padding: 20px calc(var(--bento-gap) * 0.8);
      }

      /* Modale responsive */
      .card-modal-content {
            padding: 20px;
        }
        .modal-header {
            flex-direction: column;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 10px;
        }
        .modal-emoji {
            margin-right: 0;
            margin-bottom: 10px;
        }
        .modal-title {
            font-size: 1.4em;
        }
        .modal-content-text {
            font-size: 0.95em;
        }
        .card-modal-close-btn {
            font-size: 2em;
        }
    }

    @media (max-width: 480px) {
        .bento-board {
            grid-template-columns: 1fr;
        }
        .card-col-span-2, .card-col-span-3, .card-col-span-4 { grid-column: span 1; }
        .card.card-row-span-2 { min-height: calc( (140px * 2) + var(--bento-gap) * 0.8 );}
        .card.card-col-span-2.card-row-span-2 { min-height: calc( (140px * 2) + var(--bento-gap) * 0.8 );}
    .app-banner-section {
            margin: calc(var(--bento-gap) * 0.8) auto 30px auto; /* Centrer la section horizontalement et un peu moins de marge */
        }
        .app-banner-section a {
            max-width: 100%; /* S'assurer qu'il prend toute la largeur disponible du parent (qui est maintenant centré) */
        }
    }

</style>
</head>
<body>

  <div class="main-white-frame"> <!-- DÉBUT DU CADRE BLANC -->

    <header class="header-banner">
      <img src="https://raw.githubusercontent.com/SUDCRM59/Bulletin/refs/heads/main/img/logo.gif" alt="Logo Sud CRM59" class="logo-syndicat">
      <h1>FrequenCE SUD</h1>
      <p>Bulletin d'Information Syndical - <span id="bulletinPeriodDisplay">Chargement...</span></p>
    </header>

    <div class="bento-board" id="bentoBoard">
      <p style="grid-column: 1 / -1; text-align: center; color: #777;">Chargement du bulletin...</p>
    </div>
<hr>
    <section class="archive-section">
        <h3>Archives des Bulletins</h3>
        <div id="archiveMenu" class="archive-menu">
            <!-- Les chips d'archives seront insérées ici par JavaScript -->
            <p class="loading-message" style="margin:0; font-size:0.9em;">Chargement des archives...</p>
        </div>
    </section>

    <hr class="section-separator"> <!-- Ligne de séparation 1 -->

    <!-- SECTION POUR L'ÉQUIPE -->
    <section class="team-contact-section">
        <p>
           <b>Pour toutes questions ou informations complémentaires, rapprochez-vous de vos élus SUD.</b><br>
        </p>
        <p>
            <strong>Représentant Syndical :</strong> Laurent Martens (Enedis)
        </p>
        <div class="team-photos">
            <div class="team-photo-wrapper">
                <img src="https://raw.githubusercontent.com/SUDCRM59/Bulletin/refs/heads/main/membres/sb.jpg" alt="Souad Belal">
                <p>Souad Belal<br>Abeille<br>06.23.91.45.95</p>
            </div>
            <div class="team-photo-wrapper">
                <img src="https://raw.githubusercontent.com/SUDCRM59/Bulletin/refs/heads/main/membres/bb.jpg" alt="Bouchra Bensaddik">
                <p>Bouchra Bensaddik<br>Enedis</p>
            </div>
            <div class="team-photo-wrapper">
                <img src="https://raw.githubusercontent.com/SUDCRM59/Bulletin/refs/heads/main/membres/ld.jpg" alt="Latifa Daussy">
               <p>Latifa Daussy<br>Enedis</p>
            </div>
            <div class="team-photo-wrapper">
                <img src="https://raw.githubusercontent.com/SUDCRM59/Bulletin/refs/heads/main/membres/jn.jpg" alt="Julien Nunne">
                <p>Julien Nunne<br>AG2R<br>06.17.97.31.42</p>
            </div>
            <div class="team-photo-wrapper">
                <img src="https://raw.githubusercontent.com/SUDCRM59/Bulletin/refs/heads/main/membres/rb.jpg" alt="Rudy Bodart">
                <p>Rudy Bodart<br>EHS<br>06.26.15.61.40</p>
            </div>

        </div>
    </section>
    <!-- FIN SECTION ÉQUIPE -->

    <hr class="section-separator"> <!-- Ligne de séparation 2 -->

    <!-- BANNIÈRE DE L'APPLICATION MOBILE (IMAGE UNIQUE) -->
    <section class="app-banner-section">
        <!-- Le lien doit englober l'image entière pour être cliquable -->
        <a href="#" target="_blank">
            <picture>
                <!-- Source pour les écrans <= 680px (mobile) -->
                <source media="(max-width: 680px)" srcset="https://raw.githubusercontent.com/SUDCRM59/Bulletin/refs/heads/main/img/SUD-App-BanMobile.png">
                <!-- Source par défaut pour les écrans > 680px (desktop), ou fallback si <picture> n'est pas supporté -->
                <img src="https://raw.githubusercontent.com/SUDCRM59/Bulletin/refs/heads/main/img/SUD-App-Ban.png" 
                     alt="L'application mobile du syndicat SUD P2ST est arrivée ! Téléchargez-la sur Android ou Apple Store en recherchant SUD P2ST." 
                     class="app-banner-image">
            </picture>
        </a>
    </section>
    <!-- FIN BANNIÈRE APPLICATION MOBILE -->

    <hr class="section-separator"> <!-- Ligne de séparation 3 (Optionnel, mais bien pour séparer du footer) -->

    <!-- FOOTER RAFFINÉ -->
    <footer class="footer-contact">
      <img src="https://raw.githubusercontent.com/SUDCRM59/Bulletin/refs/heads/main/img/qrcode-SiteSUD.png"
           alt="QR Code Site Web SUD CRM59" class="qr-code">
      <p>
          <strong>CONTACT SUD CRM59</strong><br>
          <a href="mailto:syndicatsud59@gmail.com">syndicatsud59@gmail.com</a><br>
          Déléguée Syndicale: Souad Belal – 06.23.91.45.95
      </p>
      <p>
          <a href="HTTP://WWW.SYNDICATSUDCRM59.FR" target="_blank">Site Web</a> |
          <a href="https://www.facebook.com/syndicatsudcrm59" target="_blank">Facebook</a>
      </p>
    </footer>
    <!-- FIN FOOTER RAFFINÉ -->

  </div> <!-- FIN DU CADRE BLANC (.main-white-frame) -->

  <!-- Modal pour l'affichage étendu de la carte -->
  <div id="cardModal" class="card-modal">
      <div class="card-modal-content">
          <button class="card-modal-close-btn">×</button>
          <div class="modal-header">
              <span id="modalEmoji" class="modal-emoji"></span>
              <h2 id="modalTitle" class="modal-title"></h2>
          </div>
          <div class="modal-image-container">
              <img id="modalImage" src="" alt="" class="modal-image">
          </div>
          <div id="modalContent" class="modal-content-text"></div>
          <div class="modal-actions">
              <a id="modalLink" href="#" target="_blank" class="btn btn-primary modal-btn-link" style="display:none;">Voir l'article complet</a>
          </div>
      </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <script>
    const bentoBoardPublic = document.getElementById('bentoBoard');
    const bulletinPeriodDisplay = document.getElementById('bulletinPeriodDisplay');
    const archiveMenu = document.getElementById('archiveMenu');

    // Références DOM pour la modale
    const cardModal = document.getElementById('cardModal');
    const modalCloseBtn = document.querySelector('.card-modal-close-btn');
    const modalTitle = document.getElementById('modalTitle');
    const modalEmoji = document.getElementById('modalEmoji');
    const modalImage = document.getElementById('modalImage');
    const modalContent = document.getElementById('modalContent');
    const modalLink = document.getElementById('modalLink');
    const modalContentContainer = document.querySelector('.card-modal-content');

    function isDarkColor(hexColor) {
        if (!hexColor || hexColor === '#ffffff') return false;
        const r = parseInt(hexColor.substring(1, 3), 16);
        const g = parseInt(hexColor.substring(3, 5), 16);
        const b = parseInt(hexColor.substring(5, 7), 16);
        const y = (r * 299 + g * 587 + b * 114) / 1000;
        return y < 128;
    }

    function attachExpandListeners() {
        bentoBoardPublic.addEventListener('click', function(e) {
            // Gérer le bouton "Voir plus" / "Voir moins"
            if (e.target && e.target.classList.contains('btn-expand')) {
                const btn = e.target;
                const card = btn.closest('.card');
                if (card) {
                    card.classList.toggle('expanded');
                    if (card.classList.contains('expanded')) {
                        btn.textContent = 'Voir moins';
                    } else {
                        btn.textContent = 'Voir plus';
                    }
                }
            }

            // Gérer le bouton "Ouvrir en grand" (+)
            if (e.target && e.target.classList.contains('open-modal-btn')) {
                const cardEl = e.target.closest('.card');
                if (!cardEl) return;

                const cardId = cardEl.id;
                const cardData = currentBulletinCards.find(c => c.id === cardId);
                if (!cardData) {
                    console.error("Données de carte introuvables pour l'ID:", cardId);
                    return;
                }

                // Remplir la modale
                modalTitle.textContent = cardData.title || '';
                modalEmoji.innerHTML = cardData.emoji || '';
                
                // Gérer l'image
                if (cardData.image) {
                    modalImage.src = cardData.image;
                    modalImage.alt = cardData.title || 'Image de la carte';
                    modalImage.style.display = 'block';
                } else {
                    modalImage.src = '';
                    modalImage.alt = '';
                    modalImage.style.display = 'none';
                }

                // Pour le contenu complet (initial + extra)
                let fullModalContent = cardData.initialContent || '';
                if (cardData.hasExpandButton && (cardData.extraContent || '').trim() !== '') {
                    fullModalContent += `<div class="extra-content">${cardData.extraContent}</div>`;
                } else if (cardData.content && !cardData.initialContent && !cardData.extraContent) {
                    fullModalContent = cardData.content;
                }
                
                modalContent.innerHTML = fullModalContent;

                // Gérer le lien
                if (cardData.linkUrl) {
                    modalLink.href = cardData.linkUrl;
                    modalLink.style.display = 'inline-block';
                } else {
                    modalLink.href = '#';
                    modalLink.style.display = 'none';
                }

                // Appliquer les classes CSS personnalisées à la modale
                modalContentContainer.className = 'card-modal-content'; // Réinitialiser pour éviter les cumuls
                if (cardData.customClasses) {
                    cardData.customClasses.split(' ').forEach(cls => {
                        if (cls) modalContentContainer.classList.add(cls);
                    });
                }
                // Appliquer la couleur de fond et la classe text-light
                if (cardData.bgColor && isDarkColor(cardData.bgColor)) {
                    modalContentContainer.style.backgroundColor = cardData.bgColor;
                    modalContentContainer.classList.add('text-light');
                } else {
                    modalContentContainer.style.backgroundColor = '#fff';
                    modalContentContainer.classList.remove('text-light');
                }


                cardModal.classList.add('is-open');
                document.body.style.overflow = 'hidden';
            }
        });
    }

    // Fermer la modale
    modalCloseBtn.addEventListener('click', () => {
        cardModal.classList.remove('is-open');
        document.body.style.overflow = '';
    });

    // Fermer la modale en cliquant en dehors du contenu
    cardModal.addEventListener('click', (e) => {
        if (e.target === cardModal) {
            cardModal.classList.remove('is-open');
            document.body.style.overflow = '';
        }
    });

    // Fermer la modale avec la touche Échap
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && cardModal.classList.contains('is-open')) {
            cardModal.classList.remove('is-open');
            document.body.style.overflow = '';
        }
    });


    // Votre firebaseConfig (copiée depuis votre console Firebase)
    const firebaseConfig = {
        apiKey: "AIzaSyAmu14nCF6x0cblWBFmP44uHJ3tI1McDSA",
        authDomain: "sudcrm59.firebaseapp.com",
        projectId: "sudcrm59",
        storageBucket: "sudcrm59.firebasestorage.app",
        messagingSenderId: "487748398932",
        appId: "1:487748398932:web:679ff7f5fcd8b1d6d762c1"
    };

    // Initialiser Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let currentDisplayedBulletinId = null;
    let currentBulletinCards = [];

    async function loadAndRenderBulletin() {
        const params = new URLSearchParams(window.location.search);
        const requestedBulletinId = params.get('id');

        let bulletinDoc;

        try {
            if (requestedBulletinId) {
                console.log(`Attempting to load bulletin with ID: ${requestedBulletinId}`);
                bulletinDoc = await db.collection('bulletins').doc(requestedBulletinId).get();
            } else {
                console.log("Loading latest bulletin...");
                const latestDocSnapshot = await db.collection('bulletins')
                                                  .orderBy(firebase.firestore.FieldPath.documentId(), 'desc') 
                                                  .limit(1) 
                                                  .get();
                if (!latestDocSnapshot.empty) {
                    bulletinDoc = latestDocSnapshot.docs[0]; 
                }
            }

            if (!bulletinDoc || !bulletinDoc.exists || !bulletinDoc.data()) {
                bentoBoardPublic.innerHTML = `<p style="grid-column: 1 / -1; text-align: center; color: #777;">Aucun bulletin disponible pour le moment ou l'ID spécifié n'existe pas.</p>`;
                bulletinPeriodDisplay.textContent = "Non défini";
                currentDisplayedBulletinId = null;
                return;
            }
            
            const data = bulletinDoc.data();
            currentBulletinCards = data.cards;
            const period = data.period || "Non défini"; 
            currentDisplayedBulletinId = bulletinDoc.id;

            bulletinPeriodDisplay.textContent = period;

            if (!currentBulletinCards || currentBulletinCards.length === 0) {
                bentoBoardPublic.innerHTML = `<p style="grid-column: 1 / -1; text-align: center; color: #777;">Le bulletin est vide.</p>`;
                return;
            }

            bentoBoardPublic.innerHTML = '';

            currentBulletinCards.forEach((cardData, index) => {
                const cardEl = document.createElement('div');
                cardEl.className = 'card';
                cardEl.id = cardData.id;

                if (cardData.colSpan && cardData.colSpan > 1) cardEl.classList.add(`card-col-span-${cardData.colSpan}`);
                if (cardData.rowSpan && cardData.rowSpan > 1) cardEl.classList.add(`card-row-span-${cardData.rowSpan}`);
                if (cardData.customClasses) cardData.customClasses.split(' ').forEach(cls => { if(cls) cardEl.classList.add(cls);});
                
                if (cardData.bgColor && cardData.bgColor !== '#ffffff') {
                    cardEl.style.backgroundColor = cardData.bgColor;
                    if (isDarkColor(cardData.bgColor)) {
                        cardEl.classList.add('text-light');
                    }
                }
                
                if (cardData.image) {
                    cardEl.classList.add('card-with-image');
                    cardEl.style.backgroundImage = `url('${cardData.image}')`;
                }

                cardEl.style.animationDelay = `${(index * 0.05) + 0.05}s`;

                let cardInnerHtml = '';
                if (cardData.emoji) {
                    cardInnerHtml += `<span class="emoji-icon">${cardData.emoji}</span>`;
                } else if (!cardData.image) {
                    cardInnerHtml += `<div class="card-icon-large">📄</div>`;
                }

                cardInnerHtml += `<h2 class="card-title">${cardData.title || 'Titre de la carte'}</h2>`;
                cardInnerHtml += `<div class="card-content-wrapper">`;
                cardInnerHtml += `${cardData.content || 'Contenu de la carte...'}`; 
                cardInnerHtml += `</div>`;

                cardInnerHtml += `<button class="open-modal-btn">+</button>`;


                const tempDivForCheck = document.createElement('div');
                tempDivForCheck.innerHTML = cardData.content || '';
                const hasExtraContentDiv = tempDivForCheck.querySelector('.extra-content') !== null;

                if (hasExtraContentDiv) {
                    cardInnerHtml += `<div class="card-actions"><button class="btn btn-expand btn-secondary">Voir plus</button></div>`;
                }

                cardEl.innerHTML = cardInnerHtml;
                bentoBoardPublic.appendChild(cardEl);
            });
            
        } catch (error) {
            console.error("Erreur de chargement du bulletin depuis Firebase:", error);
            bentoBoardPublic.innerHTML = `<p style="grid-column: 1 / -1; text-align: center; color: #c0392b;">Impossible de charger le bulletin. Veuillez contacter l'administrateur.</p>`;
            bulletinPeriodDisplay.textContent = "Erreur de chargement";
            currentDisplayedBulletinId = null;
        } finally {
            loadArchiveMenu();
        }
    }

    async function loadArchiveMenu() {
        if (!archiveMenu) return;
        archiveMenu.innerHTML = `<p class="loading-message" style="margin:0; font-size:0.9em;">Chargement des archives...</p>`;

        try {
            const querySnapshot = await db.collection('bulletins')
                                          .orderBy(firebase.firestore.FieldPath.documentId(), 'desc')
                                          .get();

            if (querySnapshot.empty) {
                archiveMenu.innerHTML = `<p class="loading-message" style="margin:0; font-size:0.9em;">Aucun bulletin archivé.</p>`;
                return;
            }

            archiveMenu.innerHTML = '';

            querySnapshot.forEach(doc => {
                const data = doc.data();
                const bulletinId = doc.id;
                const period = data.period || bulletinId;

                const link = document.createElement('a');
                link.href = `bulletin.html?id=${bulletinId}`;
                link.textContent = period;
                link.classList.add('archive-chip');

                if (bulletinId === currentDisplayedBulletinId) {
                    link.classList.add('active');
                }

                archiveMenu.appendChild(link);
            });

        } catch (error) {
            console.error("Erreur lors du chargement du menu d'archives depuis Firebase:", error);
            archiveMenu.innerHTML = `<p class="error-message" style="margin:0; font-size:0.9em;">Erreur de chargement des archives.</p>`;
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadAndRenderBulletin();
        attachExpandListeners();
    });

  </script>
</body>
</html>